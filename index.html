<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StreamsViewer beta</title>
    <link rel="stylesheet" href="./css/styles.css" />
  </head>

  <body>
    <div class="header">
      <!-- Toggle button belongs in the header -->
      <button
        class="drawer-toggle"
        data-drawer-toggle
        aria-controls="app-drawer"
        aria-expanded="true"
        title="Toggle sidebar"
      >
        â˜°
      </button>

      <div class="logo">StreamsViewer <i>(beta)</i></div>

      <div class="controls">
        <div class="input-container">
          <input
            type="text"
            class="stream-input"
            id="streamInput"
            placeholder="Search for Twitch channels..."
            autocomplete="on"
          />
          <div class="suggestions-dropdown" id="suggestionsDropdown"></div>
        </div>
        <button class="add-stream-btn" id="addStreamBtn">Add Stream</button>
      </div>

      <div class="user-info" id="userInfo">
        <button class="login-btn" id="loginBtn">Login with Twitch</button>
      </div>
    </div>

    <div class="app-container">
      <!-- Sidebar (the ONLY one) -->
      <aside class="sidebar" id="app-drawer">
        <div class="sidebar__inner">
          <div class="followed-channels" id="followedChannels">
            <div class="no-channels" id="noFollowedChannels">
              Login to see followed channels
            </div>
          </div>
          <button class="refresh-button" id="refreshButton">ðŸ”„ Refresh</button>
        </div>
      </aside>

      <!-- Optional scrim for mobile overlay (click to close) -->
      <div class="drawer-scrim" data-drawer-scrim hidden></div>

      <!-- Main Content -->
      <div class="main-wrapper">
        <div class="main-content">
          <div class="streams-grid" id="streamsGrid">
            <div class="no-streams" id="noStreams">
              No streams added yet. Add a Twitch channel to get started!
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- App entry -->
    <script type="module" src="./js/app.js"></script>

    <!-- Drawer script (place BEFORE </body>) -->
    <script>
      (() => {
        const app = document.querySelector(".app-container");
        const btn = document.querySelector("[data-drawer-toggle]");
        const sidebar = document.getElementById("app-drawer");
        const scrim = document.querySelector("[data-drawer-scrim]");

        if (!app || !btn || !sidebar) return;

        const isMobile = () => window.matchMedia("(max-width: 768px)").matches;

        const setState = (closed) => {
          app.toggleAttribute("data-drawer-closed", closed);
          btn.setAttribute("aria-expanded", String(!closed));

          // Scrim only for mobile overlay
          if (scrim) {
            if (isMobile() && !closed) {
              scrim.hidden = false;
            } else {
              scrim.hidden = true;
            }
          }
        };

        // Toggle via button
        btn.addEventListener("click", () => {
          setState(!app.hasAttribute("data-drawer-closed"));
        });

        // Close on scrim click (mobile)
        scrim?.addEventListener("click", () => setState(true));

        // Close on Escape (mobile)
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && isMobile()) setState(true);
        });

        // Start closed on small screens, open on desktop
        const mq = window.matchMedia("(max-width: 768px)");
        setState(mq.matches);
        mq.addEventListener?.("change", (e) => setState(e.matches));
      })();
    </script>
  </body>
</html>
